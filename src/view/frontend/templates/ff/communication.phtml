<?php
/** @var Magento\Framework\View\Element\Template $block */
/** @var Omikron\Factfinder\ViewModel\Communication $viewModel */
$viewModel  = $block->getViewModel();
$parameters = $viewModel->getParameters((array) $block->getData('communication_parameters'));
?>
<ff-communication<?php foreach ($parameters as $key => $value) /* @noEscape */ echo sprintf(' %s="%s"', $key, $block->escapeHtmlAttr($value)) ?>></ff-communication>
<!-- Set FieldRoles -->
<script>
    document.addEventListener('ffReady', function () {
        factfinder.communication.fieldRoles = <?= /* @noEscape */ $viewModel->getFieldRoles() ?>;
    });
</script>
<script type="text/x-magento-init">
    {
        ".search-wrapper": {
            "Omikron_Factfinder/js/search-redirect": {"targetUrl": "<?= $block->escapeJs($block->getUrl('factfinder/result')) ?>"}
        },
        "ff-communication": {
            "Omikron_Factfinder/js/view/ffcommunication": {}
        }
    }
</script>
